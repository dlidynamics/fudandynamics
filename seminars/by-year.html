---
layout: default
title: Seminars by Year
---

<h1>Seminars</h1>

{%- comment -%}
  兼容 Jekyll 3.10 的“年份收集”：
  - 先把所有 seminar 按 datetime 排好
  - 用一个字符串 year_str 去重收集年份，然后 split/sort/reverse
{%- endcomment -%}
{%- assign all_sorted = site.seminars | sort: "datetime" -%}
{%- assign year_str = "" -%}
{%- for s in all_sorted -%}
  {%- assign y = s.datetime | date: "%Y" -%}
  {%- unless year_str contains y -%}
    {%- if year_str == "" -%}
      {%- assign year_str = y -%}
    {%- else -%}
      {%- assign year_str = year_str | append: "," | append: y -%}
    {%- endif -%}
  {%- endunless -%}
{%- endfor -%}
{%- assign years = year_str | split: "," | sort | reverse -%}

<!-- 顶部年份导航（同目录相对链接，避免 baseurl 404） -->
<nav class="year-nav" style="margin: 0.75rem 0 1.25rem 0;">
  <strong style="margin-right: .5rem;">Years:</strong>
  {%- for y in years -%}
    <a href="by-year.html?y={{ y }}" style="margin-right: .5rem; text-decoration: none;">
      {{ y }}
    </a>
  {%- endfor -%}
</nav>

{%- comment -%}
  下面渲染“过去的按年份分块”。为避免在表达式字符串里出现管道符，
  我们不用 group_by_exp/where_exp，而是简单的“外层按 years 循环，
  内层遍历 all_sorted 时用 if 判断年份相等”。
{%- endcomment -%}

{%- assign now_ts = site.time | date: "%s" -%}

{%- for y in years -%}
  {%- comment -%} 先统计该年的条目数量，用于 summary 的 (N) {%- endcomment -%}
  {%- assign count = 0 -%}
  {%- for s in all_sorted -%}
    {%- assign y2 = s.datetime | date: "%Y" -%}
    {%- assign s_ts = s.datetime | date: "%s" -%}
    {%- if y2 == y and s_ts < now_ts -%}
      {%- assign count = count | plus: 1 -%}
    {%- endif -%}
  {%- endfor -%}

  {%- if count > 0 -%}
    <details class="seminar-year" id="year-{{ y }}" data-year="{{ y }}">
      <summary>
        <h2 style="display:inline; margin:0;">{{ y }}</h2>
        <span aria-hidden="true" style="margin-left:.5rem; font-size:.9em; opacity:.7;">({{ count }})</span>
      </summary>

      <ul class="seminar-list" style="margin-top:.75rem;">

        {%- comment -%}
          再次遍历 all_sorted，输出该年、且已发生（过去）的条目。
          这保持与 “seminars” 子页相同的“过去分年显示”逻辑。
          如果你的“单条 seminar 的 HTML”在 seminars 子页里有固定结构，
          把下面 <li>…</li> 换成你的那段（或用 include）。
        {%- endcomment -%}
        {%- for s in all_sorted -%}
          {%- assign y2 = s.datetime | date: "%Y" -%}
          {%- assign s_ts = s.datetime | date: "%s" -%}
          {%- if y2 == y and s_ts < now_ts -%}
           <li>
  <div class="seminar-item-title"><strong>{{ s.title }}</strong></div>
  <div class="seminar-item-meta">{{ name_line }}{% if aff_join != "" %} ({{ aff_join }}){% endif %}</div>
  <div class="seminar-item-meta">{{ s.datetime | date: "%Y-%m-%d (%a) %H:%M" }}{% if s.place %} — {{ s.place }}{% endif %}</div>
  {% if s.abstract %}
  <div class="seminar-item-abs"><strong>Abstract</strong>: {{ s.abstract }}</div>
  {% endif %}
</li>

          {%- endif -%}
        {%- endfor -%}

      </ul>
    </details>
  {%- endif -%}
{%- endfor -%}

<script>
/* 只保留 ?y=YYYY 指定的年份区块；其余年份隐藏；并把标题改为对应年份 */
(function(){
  const params = new URLSearchParams(location.search);
  const y = params.get('y');
  if (!y) return;
  document.querySelectorAll('.seminar-year').forEach(el => {
    if (el.getAttribute('data-year') === y) {
      el.setAttribute('open', '');
      el.style.display = '';
    } else {
      el.style.display = 'none';
    }
  });
  const h1 = document.querySelector('h1');
  if (h1) h1.textContent = 'Seminars — ' + y;
})();
</script>
